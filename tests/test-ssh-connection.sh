#!/bin/bash
# Test Script for SSH Connection Module
# Version: 1.00
# Date: 2025-11-22
# Purpose: ssh_connection.sh ëª¨ë“ˆì˜ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ì‚¬ìš©ë²•ì„ ì‹œì—°

# ============================================================================
# Script Setup
# ============================================================================

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
LIB_DIR="${SCRIPT_DIR}/lib"

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# ============================================================================
# Load Required Modules
# ============================================================================

# Load common functions
if [ -f "${LIB_DIR}/common.sh" ]; then
	. "${LIB_DIR}/common.sh"
else
	echo -e "${RED}âŒ Error: common.sh not found${NC}"
	exit 1
fi

# Load SSH connection module
if [ -f "${LIB_DIR}/ssh_connection.sh" ]; then
	. "${LIB_DIR}/ssh_connection.sh"
else
	echo -e "${RED}âŒ Error: ssh_connection.sh not found${NC}"
	exit 1
fi

# ============================================================================
# Test Helper Functions
# ============================================================================

# Function: Print test header
print_header() {
	local header=$1
	echo -e "\n${BLUE}========================================${NC}"
	echo -e "${BLUE}${header}${NC}"
	echo -e "${BLUE}========================================${NC}"
}

# Function: Print test case
print_test_case() {
	local num=$1
	local description=$2
	echo -e "\n${YELLOW}[Test Case $num] $description${NC}"
}

# Function: Print test result
print_result() {
	local test_name=$1
	local result=$2
	if [ $result -eq 0 ]; then
		echo -e "${GREEN}âœ… PASS: $test_name${NC}"
		return 0
	else
		echo -e "${RED}âŒ FAIL: $test_name (exit code: $result)${NC}"
		return 1
	fi
}

# Function: Print info message
print_info() {
	local message=$1
	echo -e "${BLUE}â„¹ï¸  $message${NC}"
}

# Function: Print warning message
print_warning() {
	local message=$1
	echo -e "${YELLOW}âš ï¸  $message${NC}"
}

# ============================================================================
# Test Cases
# ============================================================================

print_header "SSH Connection Test Module - Usage Examples and Tests"

# Test 1: Test to localhost with invalid port (should fail)
print_test_case 1 "SSH ì—°ê²° í…ŒìŠ¤íŠ¸: localhost (í¬íŠ¸ 9999 - ì‹¤íŒ¨ ì˜ˆìƒ)"
echo -e "${YELLOW}ì´ í…ŒìŠ¤íŠ¸ëŠ” localhostì˜ 22ë²ˆ í¬íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ëŠ” 9999ë²ˆ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤íŒ¨ë¥¼ ì‹œì—°í•©ë‹ˆë‹¤.${NC}"
print_info "ì‹¤í–‰ ëª…ë ¹ì–´:"
echo "  test_ssh_connection \"localhost\" \"9999\" \"root\" \"\" \"\" \"0\" \"test-server\""
print_info "ì‹¤í–‰ ê²°ê³¼:"
test_ssh_connection "localhost" "9999" "root" "" "" "0" "test-server"
local test1_result=$?
print_result "localhost ì—°ê²° (í¬íŠ¸ 9999)" $test1_result

# Test 2: SSH connection with invalid credentials
print_test_case 2 "SSH ì—°ê²° í…ŒìŠ¤íŠ¸: ì˜ëª»ëœ ì‚¬ìš©ìëª…"
echo -e "${YELLOW}ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìëª…ìœ¼ë¡œ ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤.${NC}"
print_info "ì‹¤í–‰ ëª…ë ¹ì–´:"
echo "  test_ssh_connection \"localhost\" \"22\" \"nonexistentuser\" \"\" \"\" \"1001\" \"test-server-01\""
print_info "ì‹¤í–‰ ê²°ê³¼:"
test_ssh_connection "localhost" "22" "nonexistentuser" "" "" "1001" "test-server-01"
local test2_result=$?
echo -e "${YELLOW}ì˜ˆìƒ: ì—°ê²° ì‹¤íŒ¨${NC}"
if [ $test2_result -ne 0 ]; then
	echo -e "${GREEN}âœ… ì˜ˆìƒëŒ€ë¡œ ì—°ê²°ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.${NC}"
fi

# Test 3: SSH connection with no authentication method
print_test_case 3 "SSH ì—°ê²° í…ŒìŠ¤íŠ¸: ì¸ì¦ ë°©ì‹ ì—†ìŒ"
echo -e "${YELLOW}ë¹„ë°€ë²ˆí˜¸ë„ í‚¤ë„ ì œê³µí•˜ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.${NC}"
print_info "ì‹¤í–‰ ëª…ë ¹ì–´:"
echo "  test_ssh_connection \"192.168.1.100\" \"22\" \"testuser\" \"\" \"\" \"1002\" \"server-02\""
print_info "ì‹¤í–‰ ê²°ê³¼:"
test_ssh_connection "192.168.1.100" "22" "testuser" "" "" "1002" "server-02"
local test3_result=$?
print_result "ì¸ì¦ ë°©ì‹ ì—†ìŒ" $test3_result

# ============================================================================
# Usage Examples Section
# ============================================================================

print_header "SSH Connection Module - ì‚¬ìš© ë°©ë²•"

print_test_case "A" "ëª¨ë“ˆ ë¡œë“œ ë° ê¸°ë³¸ ì‚¬ìš©ë²•"
cat << 'EOF'
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ëª¨ë“ˆ ë¡œë“œí•˜ê¸°                                             â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚    . /path/to/lib/ssh_connection.sh                         â”‚
â”‚                                                             â”‚
â”‚ 2. SSH ì—°ê²° í…ŒìŠ¤íŠ¸ (ë¹„ë°€ë²ˆí˜¸ ì¸ì¦)                           â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚    test_ssh_connection "192.168.1.100" "22" "root" "" \     â”‚
â”‚                       "mypassword" "1001" "server-01"       â”‚
â”‚    if [ $? -eq 0 ]; then                                    â”‚
â”‚        echo "SSH ì—°ê²° ì„±ê³µ"                                  â”‚
â”‚    else                                                     â”‚
â”‚        echo "SSH ì—°ê²° ì‹¤íŒ¨"                                  â”‚
â”‚    fi                                                       â”‚
â”‚                                                             â”‚
â”‚ 3. SSH ì—°ê²° í…ŒìŠ¤íŠ¸ (í‚¤ ê¸°ë°˜ ì¸ì¦)                            â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚    test_ssh_connection "192.168.1.101" "22" "ubuntu" \     â”‚
â”‚                       "/home/user/.ssh/id_rsa" "" \         â”‚
â”‚                       "1002" "server-02"                    â”‚
â”‚    if [ $? -eq 0 ]; then                                    â”‚
â”‚        echo "SSH ì—°ê²° ì„±ê³µ"                                  â”‚
â”‚    fi                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
EOF
echo ""

print_test_case "B" "ë‹¤ì–‘í•œ ì¸ì¦ ë°©ì‹ ì‚¬ìš© ì˜ˆì œ"
cat << 'EOF'
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ë°©ì‹ ì‚¬ìš©                                       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ 
â”‚ # ì„¤ì •
â”‚ SSH_HOST="192.168.1.100"
â”‚ SSH_PORT="22"
â”‚ SSH_USER="root"
â”‚ SSH_PASSWORD="mypassword123"
â”‚ LSSN="1001"
â”‚ HOSTNAME="web-server-01"
â”‚
â”‚ # ì‹¤í–‰
â”‚ test_ssh_connection "$SSH_HOST" "$SSH_PORT" "$SSH_USER" "" \
â”‚                    "$SSH_PASSWORD" "$LSSN" "$HOSTNAME"
â”‚ 
â”‚ if [ $? -eq 0 ]; then
â”‚     echo "âœ… SSH ì—°ê²° ì„±ê³µ!"
â”‚ else
â”‚     echo "âŒ SSH ì—°ê²° ì‹¤íŒ¨"
â”‚ fi
â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í‚¤ ê¸°ë°˜ ì¸ì¦ ë°©ì‹ ì‚¬ìš©                                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚
â”‚ # ì„¤ì •
â”‚ SSH_HOST="192.168.1.101"
â”‚ SSH_PORT="22"
â”‚ SSH_USER="ubuntu"
â”‚ SSH_KEY="/home/user/.ssh/id_rsa"
â”‚ LSSN="1002"
â”‚ HOSTNAME="app-server-02"
â”‚
â”‚ # ì‹¤í–‰
â”‚ test_ssh_connection "$SSH_HOST" "$SSH_PORT" "$SSH_USER" \
â”‚                    "$SSH_KEY" "" "$LSSN" "$HOSTNAME"
â”‚
â”‚ if [ $? -eq 0 ]; then
â”‚     echo "âœ… SSH ì—°ê²° ì„±ê³µ!"
â”‚ else
â”‚     echo "âŒ SSH ì—°ê²° ì‹¤íŒ¨"
â”‚ fi
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
EOF
echo ""

print_test_case "C" "ë£¨í”„ì—ì„œ ì—¬ëŸ¬ ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸"
cat << 'EOF'
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ # ì„œë²„ ë¦¬ìŠ¤íŠ¸
â”‚ SERVERS=(
â”‚     "192.168.1.100:22:root:password123:1001:web-01"
â”‚     "192.168.1.101:22:ubuntu:/etc/ssh/id_rsa:1002:app-02"
â”‚     "192.168.1.102:2222:admin:password456:1003:db-01"
â”‚ )
â”‚
â”‚ # ì—°ê²° í…ŒìŠ¤íŠ¸ ë£¨í”„
â”‚ for server_info in "${SERVERS[@]}"; do
â”‚     IFS=':' read -r host port user auth_data lssn hostname \
â”‚         <<< "$server_info"
â”‚
â”‚     # í‚¤ íŒŒì¼ì¸ì§€ ë¹„ë°€ë²ˆí˜¸ì¸ì§€ íŒë‹¨
â”‚     if [ -f "$auth_data" ]; then
â”‚         key_file="$auth_data"
â”‚         password=""
â”‚     else
â”‚         key_file=""
â”‚         password="$auth_data"
â”‚     fi
â”‚
â”‚     echo "í…ŒìŠ¤íŠ¸ ì¤‘: $hostname ($host)"
â”‚     test_ssh_connection "$host" "$port" "$user" "$key_file" \
â”‚                        "$password" "$lssn" "$hostname"
â”‚
â”‚     if [ $? -eq 0 ]; then
â”‚         echo "âœ… $hostname ì—°ê²° ì„±ê³µ"
â”‚     else
â”‚         echo "âŒ $hostname ì—°ê²° ì‹¤íŒ¨"
â”‚     fi
â”‚ done
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
EOF
echo ""

print_test_case "D" "ë°˜í™˜ ì½”ë“œ (Return Codes) ì„¤ëª…"
cat << 'EOF'
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë°˜í™˜ ì½”ë“œ (Return Code)                                      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚
â”‚ 0   â†’ SSH ì—°ê²° ì„±ê³µ
â”‚ 1   â†’ SSH ì—°ê²° ì‹¤íŒ¨ (íƒ€ì„ì•„ì›ƒ, ê±°ë¶€, ì¸ì¦ ì‹¤íŒ¨ ë“±)
â”‚ 125 â†’ ì‚¬ìš© ê°€ëŠ¥í•œ ì¸ì¦ ë°©ì‹ ì—†ìŒ (ë¹„ë°€ë²ˆí˜¸ë„ í‚¤ë„ ì œê³µ ì•ˆ ë¨)
â”‚ 126 â†’ SSH ëª…ë ¹ ì‹¤íŒ¨ ë˜ëŠ” SCP ì‹¤íŒ¨
â”‚ 127 â†’ sshpass ë¯¸ì„¤ì¹˜ (ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ì‚¬ìš© ì‹œ)
â”‚
â”‚ # ì˜ˆì œ: ë°˜í™˜ ì½”ë“œ ì²˜ë¦¬
â”‚ test_ssh_connection "$host" "$port" "$user" "$key" "$pass" \
â”‚                    "$lssn" "$hostname"
â”‚ result=$?
â”‚
â”‚ case $result in
â”‚     0)   echo "ì—°ê²° ì„±ê³µ" ;;
â”‚     125) echo "ì¸ì¦ ì •ë³´ ì—†ìŒ" ;;
â”‚     126) echo "SSH ëª…ë ¹ ì‹¤íŒ¨" ;;
â”‚     127) echo "sshpass ë¯¸ì„¤ì¹˜" ;;
â”‚     *)   echo "ê¸°íƒ€ ì˜¤ë¥˜ (ì½”ë“œ: $result)" ;;
â”‚ esac
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
EOF
echo ""

print_test_case "E" "ë¡œê¹… ë° ë””ë²„ê¹…"
cat << 'EOF'
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SSH ì—°ê²° í…ŒìŠ¤íŠ¸ëŠ” stderrì— ìì„¸í•œ ë¡œê¹… ì •ë³´ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚
â”‚ # ë¡œê·¸ ë‚´ìš©
â”‚ [ssh_connection.sh] ğŸŸ¢ SSH ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘: ...
â”‚ [ssh_connection.sh] ğŸŸ¢ SSH ì—°ê²° ì„±ê³µ: ...
â”‚ [ssh_connection.sh] âŒ SSH ì—°ê²° ì‹¤íŒ¨: ...
â”‚
â”‚ # ë¡œê·¸ ìº¡ì²˜ ë° ì €ì¥ ì˜ˆì œ
â”‚ test_ssh_connection "$host" "$port" "$user" "$key" "$pass" \
â”‚                    "$lssn" "$hostname" 2> /tmp/ssh_test.log
â”‚
â”‚ # ë¡œê·¸ í™•ì¸
â”‚ cat /tmp/ssh_test.log
â”‚
â”‚ # íŠ¹ì • ì •ë³´ë§Œ ì¶”ì¶œ
â”‚ grep "ì„±ê³µ" /tmp/ssh_test.log
â”‚ grep "âŒ" /tmp/ssh_test.log  # ì‹¤íŒ¨ë§Œ ì¶”ì¶œ
â”‚
â”‚ # ì‹¤ì‹œê°„ ë¡œê¹… (ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸)
â”‚ (
â”‚     test_ssh_connection "host1" "22" "user1" "" "pass1" "1001" "s1" 2>&1
â”‚     test_ssh_connection "host2" "22" "user2" "" "pass2" "1002" "s2" 2>&1
â”‚ ) | tee /tmp/ssh_test_all.log
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
EOF
echo ""

print_test_case "F" "í˜„ì‹¤ì ì¸ í”„ë¡œë•ì…˜ ì‚¬ìš© ì˜ˆì œ"
cat << 'EOF'
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ #!/bin/bash
â”‚ # Production SSH Connection Test Example
â”‚
â”‚ . ./lib/ssh_connection.sh
â”‚ . ./lib/common.sh
â”‚
â”‚ # ì„¤ì •
â”‚ SSH_HOST="production-server.example.com"
â”‚ SSH_PORT="22"
â”‚ SSH_USER="monitoring"
â”‚ SSH_KEY="/etc/giip/ssh/monitoring_key.rsa"
â”‚ LSSN="5001"
â”‚ HOSTNAME="prod-app-01"
â”‚ MAX_RETRIES=3
â”‚ RETRY_INTERVAL=5
â”‚
â”‚ # ì¬ì‹œë„ ë¡œì§
â”‚ for attempt in $(seq 1 $MAX_RETRIES); do
â”‚     echo "ì—°ê²° ì‹œë„ $attempt/$MAX_RETRIES..."
â”‚
â”‚     test_ssh_connection "$SSH_HOST" "$SSH_PORT" "$SSH_USER" \
â”‚                        "$SSH_KEY" "" "$LSSN" "$HOSTNAME"
â”‚     result=$?
â”‚
â”‚     if [ $result -eq 0 ]; then
â”‚         echo "âœ… SSH ì—°ê²° ì„±ê³µ (ì‹œë„ $attempt)"
â”‚         exit 0
â”‚     fi
â”‚
â”‚     if [ $attempt -lt $MAX_RETRIES ]; then
â”‚         echo "âš ï¸  ì—°ê²° ì‹¤íŒ¨, ${RETRY_INTERVAL}ì´ˆ í›„ ì¬ì‹œë„..."
â”‚         sleep $RETRY_INTERVAL
â”‚     fi
â”‚ done
â”‚
â”‚ echo "âŒ SSH ì—°ê²° ì‹¤íŒ¨ (ëª¨ë“  ì¬ì‹œë„ ì†Œì§„)"
â”‚ exit 1
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
EOF
echo ""

print_test_case "G" "gateway.shì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•"
cat << 'EOF'
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ gateway.shì—ì„œ ssh_connection.sh ëª¨ë“ˆ ì‚¬ìš©                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚
â”‚ # 1. gateway.shì— ëª¨ë“ˆ ë¡œë“œ ì¶”ê°€
â”‚ if [ -f "${LIB_DIR}/ssh_connection.sh" ]; then
â”‚     . "${LIB_DIR}/ssh_connection.sh"
â”‚ fi
â”‚
â”‚ # 2. SSH ì—°ê²° í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
â”‚ test_ssh_connection "$ssh_host" "$ssh_port" "$ssh_user" \
â”‚                    "$ssh_key_path" "$ssh_password" \
â”‚                    "$server_lssn" "$hostname"
â”‚
â”‚ ssh_connection_result=$?
â”‚
â”‚ # 3. ê²°ê³¼ ì²˜ë¦¬
â”‚ if [ $ssh_connection_result -eq 0 ]; then
â”‚     # SSH ì—°ê²° ì„±ê³µ - ì›ê²© ëª…ë ¹ ì‹¤í–‰
â”‚     execute_remote_command "$ssh_host" "$ssh_user" \
â”‚                           "$ssh_port" "$ssh_key_path" \
â”‚                           "$ssh_password" "$script_file" \
â”‚                           "$server_lssn" "$hostname"
â”‚ else
â”‚     # SSH ì—°ê²° ì‹¤íŒ¨ - ë¡œê¹… ë° API í˜¸ì¶œ
â”‚     echo "SSH ì—°ê²° ì‹¤íŒ¨"
â”‚ fi
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
EOF
echo ""

# ============================================================================
# Function Documentation
# ============================================================================

print_header "Function Reference"

cat << 'EOF'
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ test_ssh_connection()                                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ëª©ì : ë¦¬ëª¨íŠ¸ ì„œë²„ë¡œì˜ SSH ì—°ê²°ì„±ì„ í…ŒìŠ¤íŠ¸                    â•‘
â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘
â•‘ ë§¤ê°œë³€ìˆ˜:                                                   â•‘
â•‘   $1: remote_host       - ë¦¬ëª¨íŠ¸ ì„œë²„ IP/í˜¸ìŠ¤íŠ¸ëª…           â•‘
â•‘   $2: remote_port       - SSH í¬íŠ¸ (ê¸°ë³¸ê°’: 22)             â•‘
â•‘   $3: remote_user       - SSH ì‚¬ìš©ìëª…                      â•‘
â•‘   $4: ssh_key           - SSH ê°œì¸í‚¤ ê²½ë¡œ (ì„ íƒ)           â•‘
â•‘   $5: ssh_password      - SSH ë¹„ë°€ë²ˆí˜¸ (ì„ íƒ)              â•‘
â•‘   $6: remote_lssn       - ë¦¬ëª¨íŠ¸ ì„œë²„ LSSN (ì„ íƒ)          â•‘
â•‘   $7: hostname          - í˜¸ìŠ¤íŠ¸ëª… (ì„ íƒ, ë¡œê¹…ìš©)          â•‘
â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘
â•‘ ë°˜í™˜ê°’:                                                     â•‘
â•‘   0   - SSH ì—°ê²° ì„±ê³µ                                       â•‘
â•‘   1   - SSH ì—°ê²° ì‹¤íŒ¨                                       â•‘
â•‘   125 - ì¸ì¦ ì •ë³´ ì—†ìŒ                                      â•‘
â•‘   126 - SSH ëª…ë ¹ ì‹¤íŒ¨                                       â•‘
â•‘   127 - sshpass ë¯¸ì„¤ì¹˜                                      â•‘
â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘
â•‘ ì˜ˆì œ:                                                       â•‘
â•‘   test_ssh_connection "192.168.1.100" "22" "root" "" \      â•‘
â•‘                      "mypass" "1001" "server-01"            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ execute_remote_command()                                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ëª©ì : SSH ì—°ê²° í›„ ë¦¬ëª¨íŠ¸ ì„œë²„ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰             â•‘
â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘
â•‘ ë§¤ê°œë³€ìˆ˜:                                                   â•‘
â•‘   $1: remote_host       - ë¦¬ëª¨íŠ¸ ì„œë²„ IP/í˜¸ìŠ¤íŠ¸ëª…           â•‘
â•‘   $2: remote_user       - SSH ì‚¬ìš©ìëª…                      â•‘
â•‘   $3: remote_port       - SSH í¬íŠ¸                          â•‘
â•‘   $4: ssh_key           - SSH ê°œì¸í‚¤ ê²½ë¡œ                   â•‘
â•‘   $5: ssh_password      - SSH ë¹„ë°€ë²ˆí˜¸                      â•‘
â•‘   $6: script_file       - ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ê²½ë¡œ        â•‘
â•‘   $7: remote_lssn       - ë¦¬ëª¨íŠ¸ ì„œë²„ LSSN (ì„ íƒ)          â•‘
â•‘   $8: hostname          - í˜¸ìŠ¤íŠ¸ëª… (ì„ íƒ, ë¡œê¹…ìš©)          â•‘
â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘
â•‘ ë°˜í™˜ê°’: 0 = ì„±ê³µ, 1 = ì‹¤íŒ¨                                 â•‘
â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘
â•‘ ë™ì‘:                                                       â•‘
â•‘   1. SSHë¥¼ í†µí•´ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ /tmp/giipTmpScript.shë¡œ    â•‘
â•‘      ì›ê²© ì„œë²„ì— ì „ì†¡ (SCP)                                 â•‘
â•‘   2. ì›ê²© ì„œë²„ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ì„¤ì • ë° ì‹¤í–‰         â•‘
â•‘   3. ì‹¤í–‰ í›„ ì›ê²© íŒŒì¼ ì‚­ì œ                                 â•‘
â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘
â•‘ ì˜ˆì œ:                                                       â•‘
â•‘   execute_remote_command "192.168.1.100" "root" "22" \     â•‘
â•‘                         "" "mypass" "/tmp/script.sh" \     â•‘
â•‘                         "1001" "server-01"                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EOF
echo ""

# ============================================================================
# Test Summary
# ============================================================================

print_header "Test Summary"

cat << 'EOF'
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SSH Connection Module í…ŒìŠ¤íŠ¸ ì™„ë£Œ                            â”‚
â”‚                                                             â”‚
â”‚ ì´ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ëŠ” ssh_connection.sh ëª¨ë“ˆì˜ ê¸°ëŠ¥ì„        â”‚
â”‚ ì‹œì—°í–ˆìŠµë‹ˆë‹¤:                                               â”‚
â”‚                                                             â”‚
â”‚ 1. âœ… SSH ì—°ê²° ì‹¤íŒ¨ ì¼€ì´ìŠ¤                                  â”‚
â”‚ 2. âœ… ì¸ì¦ ì •ë³´ ê²€ì¦                                        â”‚
â”‚ 3. âœ… ì˜¤ë¥˜ ì²˜ë¦¬ ë° ë¡œê¹…                                     â”‚
â”‚                                                             â”‚
â”‚ ì£¼ìš” ê¸°ëŠ¥:                                                  â”‚
â”‚ â€¢ ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ë°©ì‹ ì§€ì› (sshpass í•„ìš”)                   â”‚
â”‚ â€¢ í‚¤ ê¸°ë°˜ ì¸ì¦ ë°©ì‹ ì§€ì›                                    â”‚
â”‚ â€¢ ì—°ê²° íƒ€ì„ì•„ì›ƒ ì„¤ì • (10ì´ˆ)                                 â”‚
â”‚ â€¢ ìƒì„¸í•œ ë¡œê¹… ë° ì˜¤ë¥˜ ë©”ì‹œì§€                                â”‚
â”‚ â€¢ LSSN ë° í˜¸ìŠ¤íŠ¸ëª…ì„ í†µí•œ ì¶”ì  ê°€ëŠ¥ì„±                      â”‚
â”‚                                                             â”‚
â”‚ ë‹¤ìŒ ë‹¨ê³„:                                                  â”‚
â”‚ 1. gateway.shì— ssh_connection.sh ëª¨ë“ˆ ë¡œë“œ               â”‚
â”‚ 2. í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‹¤ì œ ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸                 â”‚
â”‚ 3. ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ í†µí•©                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
EOF
echo ""

print_info "ëª¨ë“ˆ íŒŒì¼ ìœ„ì¹˜: ${LIB_DIR}/ssh_connection.sh"
print_info "í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸: ${BASH_SOURCE[0]}"

exit 0
