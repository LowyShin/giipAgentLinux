# ğŸ“– Gateway ìƒì„¸ ì§„ë‹¨ ê°€ì´ë“œ

> **ì´ ë¬¸ì„œëŠ”:** ê¸°ë³¸ ì§„ë‹¨ í›„ì—ë„ ë¬¸ì œê°€ í•´ê²°ë˜ì§€ ì•Šì„ ë•Œ ì°¸ì¡°í•˜ì„¸ìš”.
> **ê¸°ë³¸ ì§„ë‹¨:** [GATEWAY_REMOTE_SERVER_DIAGNOSTIC_GUIDE.md](./GATEWAY_REMOTE_SERVER_DIAGNOSTIC_GUIDE.md) ì°¸ì¡°

---

## ğŸŸ¢ í˜„ì¬ ìƒí™© (2025-11-27 20:50 ê¸°ì¤€)

**Gateway ì •ìƒ ì‘ë™ ì¤‘ âœ…**

| í•­ëª© | ìƒíƒœ | ì„¸ë¶€ì •ë³´ |
|------|------|--------|
| **í˜¸ìŠ¤íŠ¸** | âœ… ì •ìƒ | infraops01.istyle.local (LSSN: 71240) |
| **ëª¨ë“œ** | âœ… Gateway | mode: gateway, version: 3.00 |
| **ë§ˆì§€ë§‰ ì´ë²¤íŠ¸** | shutdown | 2025-11-27 20:50:18 (ì •ìƒ ì¢…ë£Œ) |
| **DB ì²´í¬** | âœ… ì„±ê³µ | p-cnsldb02m, p-cnsldb03m (MySQL) ì‘ë‹µ ì‹œê°„ 600-650ms |
| **KVS ë°ì´í„°** | âœ… 46ê°œ | ì§€ë‚œ 60ë¶„ ë‚´ 46ê°œ ë ˆì½”ë“œ ê¸°ë¡ |

**ìµœê·¼ í™•ì¸ëœ í™œë™:**
- ğŸŸ¢ Managed DB Check: p-cnsldb03m (MySQL) - **Connection successful** - 632ms
- ğŸŸ¢ Managed DB Check: p-cnsldb02m (MySQL) - **Connection successful** - 646ms
- ğŸŸ¢ Gateway ì •ìƒ ì¢…ë£Œ (normal_exit)

---

## ğŸ“Š giipAgent3.sh ì „ì²´ ì‹¤í–‰ í”Œë¡œìš° (ìƒì„¸)

### ğŸ”„ Main Execution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ giipAgent3.sh ì‹œì‘                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ [5.1] Agent ì‹œì‘  â”‚
         â”‚ - ë²„ì „: 3.00     â”‚
         â”‚ - ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ [5.2] ì„¤ì • ë¡œë“œ       â”‚
         â”‚ - giipAgent.cnf ì½ê¸° â”‚
         â”‚ - í™˜ê²½ë³€ìˆ˜ ê²€ì¦      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ [5.3] is_gateway ê°’ í™•ì¸   â”‚
    â”‚ (DB API: LSvrGetConfig)   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                  â”‚
    is_gateway=0        is_gateway=1
    (ë˜ëŠ” false)        (ë˜ëŠ” true)
         â”‚                  â”‚
         â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ NORMAL MODE  â”‚  â”‚ GATEWAY MODE ì§„ì… â”‚
    â”‚              â”‚  â”‚ [5.3.G] ì´ˆê¸°í™”   â”‚
    â”‚ Queue ê¸°ë°˜   â”‚  â”‚ - ë¦¬ëª¨íŠ¸ ì„œë²„    â”‚
    â”‚ ì¼ë°˜ ì²˜ë¦¬    â”‚  â”‚   ëª©ë¡ ì¡°íšŒ      â”‚
    â”‚ (normal.sh) â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ [5.4] ì„œë²„ ëª©ë¡ ì¡°íšŒ â”‚
                   â”‚ API:                â”‚
                   â”‚ GatewayRemoteServerâ”‚
                   â”‚ ListForAgent       â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚
            ì„±ê³µ (count>0)   ì‹¤íŒ¨ or ë¹ˆ ë°°ì—´
                    â”‚              â”‚
                    â–¼              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ [5.5] ë£¨í”„ ì‹œì‘   â”‚  â”‚ [5.5.E] ì—ëŸ¬â”‚
         â”‚ - ê° ì„œë²„ë³„ ì²˜ë¦¬  â”‚  â”‚ - ëŒ€ê¸° í›„   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   ì¬ì‹œë„    â”‚
                  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ [5.6] ì„œë²„ë³„ ì²˜ë¦¬ ì‹œì‘      â”‚
    â”‚ - lssnë³„ ë£¨í”„              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ [5.7] SSH ì—°ê²° í…ŒìŠ¤íŠ¸      â”‚
    â”‚ - sshpass ê²€ì¦            â”‚
    â”‚ - ì¸ì¦ì •ë³´ í™•ì¸            â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                  â”‚
      ì„±ê³µ                 ì‹¤íŒ¨
         â”‚                  â”‚
         â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ [5.8] ì›ê²©   â”‚  â”‚ [5.8.E]    â”‚
    â”‚ ëª…ë ¹ ì‹¤í–‰    â”‚  â”‚ SSH ì—ëŸ¬    â”‚
    â”‚ - ë°ì´í„° ìˆ˜ì§‘â”‚  â”‚ ê¸°ë¡ ë°     â”‚
    â”‚ - KVS ì €ì¥   â”‚  â”‚ ë‹¤ìŒ ì„œë²„ë¡œ â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ [5.9] Auto-  â”‚
    â”‚Discover ì‹¤í–‰â”‚
    â”‚ - ì‹œìŠ¤í…œì •ë³´ â”‚
    â”‚   ìˆ˜ì§‘       â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ [5.10] ê´€ë¦¬DB  â”‚
    â”‚ ì²´í¬ (Gateway) â”‚
    â”‚ - MySQL/MSSQL â”‚
    â”‚ - ì„±ëŠ¥ì •ë³´     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ëª¨ë“  ì„œë²„ ì²˜ë¦¬ â”‚
    â”‚ ì™„ë£Œ?          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
         â”‚        â”‚
         ì˜ˆ      ì•„ë‹ˆì˜¤
         â”‚        â”‚
         â–¼        â””â”€â”€â”€â”€â”€â”€â”€â”
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
    â”‚ [6.0]   â”‚          â–¼
    â”‚ ì •ìƒì¢…ë£Œ â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ normal_ â”‚
    â”‚ exit    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ìƒì„¸ ì‹¤í–‰ ë‹¨ê³„ë³„ KVS Factor ë§¤í•‘

| ë‹¨ê³„ | í¬ì¸íŠ¸ | ì„¤ëª… | KVS Factor | ì •ìƒ ì‹ í˜¸ | í˜„ì¬ ìƒíƒœ |
|------|--------|------|-----------|----------|---------|
| 1 | [5.1] | Agent ì‹œì‘ | `giipagent` | `startup` í¬í•¨ | âœ… ê¸°ë¡ë¨ |
| 2 | [5.2] | ì„¤ì • ë¡œë“œ | âš ï¸ KVS ë¯¸ê¸°ë¡* | - | âœ… ì§„í–‰ |
| 3 | [5.3] | is_gateway íŒë‹¨ | `api_lsvrgetconfig_response` | `is_gateway:1` | âœ… íŒë‹¨ë¨ |
| 4 | [5.4] | ë¦¬ëª¨íŠ¸ ì„œë²„ ì¡°íšŒ | `gateway_step_5.4_success` | `count > 0` | âœ… ì¡°íšŒë¨ |
| 5 | [5.5] | ì„œë²„ ë£¨í”„ ì‹œì‘ | `gateway_server_extract` | ì„±ê³µ | âœ… ì‹œì‘ë¨ |
| 6 | [5.6] | ì„œë²„ íŒŒì‹± | `gateway_step_5.6_parsed` | ì„±ê³µ | âœ… íŒŒì‹±ë¨ |
| 7 | [5.7] | SSH í…ŒìŠ¤íŠ¸ | `gateway_step_5.9_ssh_start` | ì‹œì‘ | âœ… ì‹œì‘ë¨ |
| 8 | [5.8] | í ì¡°íšŒ | `gateway_step_5.8_success` | ì„±ê³µ | âœ… ì„±ê³µ |
| 9 | [5.9] | SSH ì‹¤í–‰ | `gateway_step_5.9_ssh_success` | ì„±ê³µ âœ… | âœ… ì„±ê³µ |
| 10 | [5.10] | ëª…ë ¹ ì‹¤í–‰ | `gateway_step_5.10_complete` | ì„±ê³µ | âœ… ì™„ë£Œ |
| 11 | [6.0] | ì •ìƒ ì¢…ë£Œ | `giipagent` | `shutdown` í¬í•¨ | âœ… ì¢…ë£Œë¨ |

**í•´ì„:** ëª¨ë“  ë‹¨ê³„ê°€ ì •ìƒ ì™„ë£Œë¨. Gateway ë¦¬ëª¨íŠ¸ ì„œë²„ ì²˜ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤!

---

## ğŸ”§ ì½”ë“œ ìˆ˜ì • ê°€ì´ë“œ (lib/gateway.sh)

### ğŸ“Œ KVS kValue ì²˜ë¦¬ ê·œì¹™

**kvs_put() í•¨ìˆ˜ëŠ” ì–´ë–¤ ê°’ì´ë“  raw ë°ì´í„°ë¡œ ì €ì¥í•©ë‹ˆë‹¤.**

```bash
# kvs.sh line 191: kValueëŠ” raw data ê·¸ëŒ€ë¡œ ì„ë² ë“œë¨
local jsondata="{\"kType\":\"${ktype}\",\"kValue\":${kvalue_json}}"
```

#### ì €ì¥ ê°€ëŠ¥í•œ ê°’:
1. JSON ê°ì²´: `'{"status":"ok","count":5}'`
2. ì¼ë°˜ í…ìŠ¤íŠ¸: `'Server processing failed'`
3. ìˆ«ì: `'12345'`
4. íŠ¹ìˆ˜ë¬¸ì í…ìŠ¤íŠ¸: `'Error: "Connection refused"'`

**ëª¨ë‘ ì—ëŸ¬ ì—†ì´ ê·¸ëŒ€ë¡œ ì €ì¥ë©ë‹ˆë‹¤!**

---

## ğŸ“– ê´€ë ¨ ìë£Œ

- [ê¸°ë³¸ ì§„ë‹¨ (ë¹ ë¥¸ ë²„ì „)](./GATEWAY_REMOTE_SERVER_DIAGNOSTIC_GUIDE.md)
- [KVS ì¡°íšŒ ê°€ì´ë“œ](../../giipdb/docs/KVS_QUERY_GUIDE.md)
- [SSH ì—°ê²° ë¡œê¹…](./SSH_CONNECTION_LOGGER.md)
